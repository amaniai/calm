{"status":{},"contains_secrets":true,"product_version":"2.9.7","spec":{"description":"Blueprint to manage network on agora","resources":{"client_attrs":{"9df03093_deployment":{"y":311.9640856959,"x":519.4831984594},"ae9ba62d-c67f-327f-95b0-06e89231231b":{"y":397.5,"x":531.5}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fa9cb616_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7fc6bc18_runbook","main_task_local_reference":{"kind":"app_task","name":"fa9cb616_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f5d919cb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6766d8a3_runbook","main_task_local_reference":{"kind":"app_task","name":"f5d919cb_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c63bba57_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"83a880bb_runbook","main_task_local_reference":{"kind":"app_task","name":"c63bba57_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c262c527_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f9dc7234_runbook","main_task_local_reference":{"kind":"app_task","name":"c262c527_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b3e03128_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"32ef2116_runbook","main_task_local_reference":{"kind":"app_task","name":"b3e03128_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"get_vlan_subnet"},{"kind":"app_task","name":"create_network_api"},{"kind":"app_task","name":"update_category"}],"name":"6164b1cc_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"get_vlan_subnet"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"create_network_api"}},{"from_task_reference":{"kind":"app_task","name":"create_network_api"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"update_category"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"get_vlan_subnet","attrs":{"exit_status":[],"script":"PRINT('NETWORK={}'.format('192.168.101.0\/24')\nPRINT('GATEWAY={}'.format('192.168.101.1')\nPRINT('POOL_START={}'.format('192.168.101.11'))\nPRINT('POOL_END={}'.format('192.168.101.200'))\nPRINT('VLAN={}'.format('234'))\nPRINT('MASK={}'.format('24'))","eval_variables":["NETWORK","GATEWAY","POOL_START","POOL_END","VLAN","MASK"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"create_network_api","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""}],"request_body":"{\n    \"name\": \"@@{CUSTOMER_ID}@@-@@{NETWORK_NAME}@@\",\n    \"vlanId\": \"@@{VLAN}@@\",\n    \"ipConfig\": {\n        \"dhcpOptions\": {\n            \"domainNameServers\": \"@@{DNS_SERVERS}@@\",\n            \"domainSearch\": \"@@{DOMAIN}@@\",\n            \"domainName\": \"@@{DOMAIN}@@\"\n        },\n        \"networkAddress\": \"@@{NETWORK}@@\",\n        \"prefixLength\": \"@@{MASK}@@\",\n        \"defaultGateway\": \"@@{GATEWAY}@@\",\n        \"pool\": [\n            {\n                \"range\": \"@@{POOL_START}@@ @@{POOL_END}@@\"\n            }\n        ]\n    }\n}","headers":[],"url":"https:\/\/@@{PrismCentral.address}@@:9440\/api\/nutanix\/v0.8\/networks?proxyClusterUuid=@@{CLUSTER_UUID}@@","response_paths":{"NEW_NETWORK_UUID":"$.networkUuid"},"retry_interval":1,"method":"POST","retry_count":1,"authentication":{"type":"basic_with_cred","credential_local_reference":{"kind":"app_credential","name":"PC_ADMIN"}},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"update_category","attrs":{"script":"# api call function\n# ================================================================\ndef http_request(api_endpoint, payload='', method='POST'):\n  username = '@@{PC_ADMIN.username}@@'\n  username_secret = '@@{PC_ADMIN.secret}@@'\n  pc_address = '@@{PrismCentral.address}@@'\n  pc_port = '9440'\n\n  url = \"https:\/\/{}:{}{}\".format(\n      pc_address,\n      pc_port,\n      api_endpoint\n  )\n  \n  headers = {\n      'Content-Type': 'application\/json',\n      'Accept': 'application\/json'\n  }\n  \n  if len(payload) > 0:\n      payload = json.dumps(payload)\n      \n  \n  resp = urlreq(\n      url,\n      verb=method,\n      auth='BASIC',\n      user=username,\n      passwd=username_secret,\n      params=payload,\n      headers=headers,\n      verify=False\n  )\n  \n  if resp.ok:\n      return json.loads(resp.content)\n  else:\n      print('Error in API call')\n      exit(1)\n\n\n\n\n#api_endpoint = '\/api\/nutanix\/v3\/subnets\/@@{NEW_NETWORK_UUID}@@'\napi_endpoint = '\/api\/nutanix\/v3\/subnets'\n\nnetwork = {}\n\nnetwork['spec'] = {'name': '@@{CUSTOMER_ID}@@-@@{NETWORK_NAME}@@'}\nnetwork['spec']['resources'] = {}\nnetwork['spec']['resources']['vswitch_name'] = '@@{BRIDGE_NAME}@@'\nnetwork['spec']['resources']['subnet_type'] = 'VLAN'\nnetwork['spec']['resources']['ip_config'] = { 'default_gateway_ip': '192.168.111.1',\n                'pool_list': [{\"range\": \"192.168.111.100 192.168.111.200\"}],\n                \"prefix_length\": 24,\n                \"subnet_ip\": \"192.168.111.0\",\n                \"dhcp_options\": {    \"domain_name_server_list\": '@@{DNS_SERVERS}@@'.replace(' ', '').split(','),\n                                     \"domain_search_list\": [\"demo.lan\"],\n                                     \"domain_name\": \"demo.lan\"}}\n\nnetwork['spec']['resources']['vlan_id'] = 45\nnetwork['spec']['cluster_reference'] = {'kind': 'cluster', 'uuid': '00059d94-d969-59f6-2f00-ac1f6b6911d9'}\nnetwork['api_version'] = '3.1'\nnetwork['metadata'] = {'kind': 'subnet', 'categories_mapping': {'OWNER': ['SHARED']}, 'use_categories_mapping': True}\n\n\nresult = http_request(api_endpoint, payload=network, method='POST')\n\n#network = {}\n#network['spec'] = result['spec']\n#network['api_version'] = result['api_version']\n#network['metadata'] = result['metadata']\n#network['metadata']['use_categories_mapping'] = True\n#del network['metadata']['last_update_time']\n#del network['metadata']['creation_time']\n#network['metadata']['categories_mapping']['OWNER'] = ['@@{CUSTOMER_ID}@@']\n\n#result = http_request(api_endpoint, payload=network, method='PUT')\nprint(json.dumps(result))\n\n\n\n      ","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"077e70c9_runbook","main_task_local_reference":{"kind":"app_task","name":"6164b1cc_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"CLUSTER_UUID","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"NETWORK_NAME","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"CUSTOMER_ID","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"create_network"}],"depends_on_list":[],"name":"API","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"NETWORK","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"GATEWAY","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"POOL_START","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"POOL_END","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"VLAN","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MASK","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"EXISTING_VM","name":"PrismCentral","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{ip_address}@@","delay_secs":"60","disable_readiness_probe":true},"editables":{"create_spec":{"address":true}},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"10.38.17.9"},"variable_list":[]}],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"RLebOY9NyeymZqbm5vt2x5sg+5ZcbrVtSxq+pwQ\/Us0PYMBUPao2IIAiAQ==:utf-8"},"name":"PC_ADMIN"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"API"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"e38eb6fa_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7f403e1b_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e38eb6fa_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"2d6f694f_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2b3f8af6_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"2d6f694f_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"9df03093_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"PrismCentral"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"Create a private network on a specific cluster for customer_id","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"create_network"}],"name":"08f2bafa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"API"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"create_network","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"077e70c9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"ee038627_runbook","main_task_local_reference":{"kind":"app_task","name":"08f2bafa_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"CLUSTER_UUID","value":"","label":"Cluster UUID","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"CUSTOMER_ID","value":"","label":"Customer ID","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"NETWORK_NAME","value":"","label":"Network Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"create_network"}],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DOMAIN","value":"demo.lan","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DNS_SERVERS","value":"10.38.17.17","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BRIDGE_NAME","value":"br0","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"PC_ADMIN"},"type":"USER"},"name":"network_03-02-2020"},"api_version":"3.0","metadata":{"last_update_time":"1580936577872586","kind":"blueprint","spec_version":27,"creation_time":"1580749037663135","name":"network_03-02-2020"}}